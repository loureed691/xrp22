<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRP Trading Bot Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .status.running {
            background: #10b981;
            color: white;
        }
        .status.stopped {
            background: #ef4444;
            color: white;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .card .value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        .card .subvalue {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .positive {
            color: #10b981;
        }
        .negative {
            color: #ef4444;
        }
        .section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #f9fafb;
            font-weight: 600;
            color: #667eea;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }
        tr:hover {
            background: #f9fafb;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸš€ XRP Trading Bot Dashboard</h1>
            <span id="status" class="status">Loading...</span>
        </header>

        <div class="grid">
            <div class="card">
                <h3>Current Balance</h3>
                <div class="value" id="current-balance">$0.00</div>
                <div class="subvalue" id="profit-percent">0%</div>
            </div>
            <div class="card">
                <h3>Total Profit</h3>
                <div class="value" id="total-profit">$0.00</div>
                <div class="subvalue">Since start</div>
            </div>
            <div class="card">
                <h3>Win Rate</h3>
                <div class="value" id="win-rate">0%</div>
                <div class="subvalue" id="win-loss">0W / 0L</div>
            </div>
            <div class="card">
                <h3>Total Trades</h3>
                <div class="value" id="total-trades">0</div>
                <div class="subvalue">Executed</div>
            </div>
        </div>

        <div class="section">
            <h2>Current Positions</h2>
            <div id="positions-container">
                <div class="loading">Loading positions...</div>
            </div>
        </div>

        <div class="section">
            <h2>Recent Trades</h2>
            <div id="trades-container">
                <div class="loading">Loading trades...</div>
            </div>
        </div>
    </div>

    <script>
        function formatCurrency(value) {
            return '$' + parseFloat(value).toFixed(2);
        }

        function formatPercent(value) {
            const formatted = parseFloat(value).toFixed(2);
            const sign = value >= 0 ? '+' : '';
            return sign + formatted + '%';
        }

        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Update status
                    const statusEl = document.getElementById('status');
                    statusEl.textContent = data.running ? 'Running' : 'Stopped';
                    statusEl.className = 'status ' + (data.running ? 'running' : 'stopped');

                    // Update metrics
                    document.getElementById('current-balance').textContent = formatCurrency(data.current_balance);
                    
                    const profitPercent = document.getElementById('profit-percent');
                    profitPercent.textContent = formatPercent(data.profit_percent);
                    profitPercent.className = 'subvalue ' + (data.profit_percent >= 0 ? 'positive' : 'negative');

                    const totalProfit = document.getElementById('total-profit');
                    totalProfit.textContent = formatCurrency(data.total_profit);
                    totalProfit.className = 'value ' + (data.total_profit >= 0 ? 'positive' : 'negative');

                    document.getElementById('win-rate').textContent = data.win_rate.toFixed(1) + '%';
                    document.getElementById('win-loss').textContent = data.winning_trades + 'W / ' + data.losing_trades + 'L';
                    document.getElementById('total-trades').textContent = data.total_trades;
                })
                .catch(error => {
                    console.error('Error fetching status:', error);
                });
        }

        function updatePositions() {
            fetch('/api/positions')
                .then(response => response.json())
                .then(positions => {
                    const container = document.getElementById('positions-container');
                    
                    if (positions.length === 0) {
                        container.innerHTML = '<div class="loading">No open positions</div>';
                        return;
                    }

                    let html = '<table><thead><tr>';
                    html += '<th>Symbol</th><th>Quantity</th><th>Entry Price</th>';
                    html += '<th>Leverage</th><th>Unrealized PnL</th></tr></thead><tbody>';
                    
                    positions.forEach(pos => {
                        const pnlClass = pos.unrealized_pnl >= 0 ? 'positive' : 'negative';
                        html += '<tr>';
                        html += '<td>' + pos.symbol + '</td>';
                        html += '<td>' + pos.qty + '</td>';
                        html += '<td>' + formatCurrency(pos.entry_price) + '</td>';
                        html += '<td>' + pos.leverage.toFixed(1) + 'x</td>';
                        html += '<td class="' + pnlClass + '">' + formatCurrency(pos.unrealized_pnl) + '</td>';
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table>';
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error fetching positions:', error);
                    document.getElementById('positions-container').innerHTML = 
                        '<div class="error">Error loading positions</div>';
                });
        }

        function updateTrades() {
            fetch('/api/trades')
                .then(response => response.json())
                .then(trades => {
                    const container = document.getElementById('trades-container');
                    
                    if (trades.length === 0) {
                        container.innerHTML = '<div class="loading">No trades yet</div>';
                        return;
                    }

                    let html = '<table><thead><tr>';
                    html += '<th>Time</th><th>Action</th><th>Side</th>';
                    html += '<th>Size</th><th>Reason</th></tr></thead><tbody>';
                    
                    trades.reverse().forEach(trade => {
                        const time = new Date(trade.timestamp).toLocaleString();
                        html += '<tr>';
                        html += '<td>' + time + '</td>';
                        html += '<td>' + trade.action.toUpperCase() + '</td>';
                        html += '<td>' + trade.side.toUpperCase() + '</td>';
                        html += '<td>' + trade.size + '</td>';
                        html += '<td>' + trade.reason + '</td>';
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table>';
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error fetching trades:', error);
                    document.getElementById('trades-container').innerHTML = 
                        '<div class="error">Error loading trades</div>';
                });
        }

        // Initial load
        updateStatus();
        updatePositions();
        updateTrades();

        // Auto-refresh every 5 seconds
        setInterval(() => {
            updateStatus();
            updatePositions();
            updateTrades();
        }, 5000);
    </script>
</body>
</html>
